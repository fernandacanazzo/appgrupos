<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js"></script>
        <link href="css/bootstrap.min.css" rel="stylesheet">
        <link href="css/shop-homepage.css" rel="stylesheet">

        <title>App</title>
        <style>.fixed-panel {
                max-height: 500px;
                overflow-y: auto;
            }</style>

    </head>
    <body style="background-color: #f7f7f7">

        <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container-fluid"> 
                <!-- Brand and toggle get grouped for better mobile display -->
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-nav"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button>
                    <a class="navbar-brand" href="#" style="margin-top: 4px;"><b>Aplicação para grupos</b></a></div>

                <!-- Collect the nav links, forms, and other content for toggling -->
                <div class="collapse navbar-collapse" id="main-nav">
                    <ul class="nav navbar-nav navbar-right">
                        <li><a style="margin-top: 4px;" href="https://fernandacanazzo.github.io/appgrupos/index.html"><span class="glyphicon glyphicon-search " style=" font-size:small;margin-right: 6px;"></span>Pesquisar grupo</a></li>
                        <li><a id="link_grp" style="margin-top: 4px;" href="#" target="_blank"><span class="glyphicon glyphicon-eye-open" style=" font-size:small;margin-right: 6px;"></span>Ver grupo no Facebook</a></li>

                    </ul>

                </div><!-- collapse navbar-collapse -->
                <!-- /.navbar-collapse --> 
            </div>
            <!-- /.container-fluid --> 
        </nav>
        <div class="container">
            <div class="row">
                <div class="col-md-6 col-md-offset-3"  style="border-style: solid; border-width:1px; border-radius:10px; border-color:#f7f7f7">

                    <div class="panel panel-primary" style="width: 100%;margin-top:50px; ">
                        <div class="panel-body text-center" style="height:85px;">

                            <div id="aviso3" class="text-center" style=" margin-top:18px"><b>Procurando publicações... por favor aguarde alguns segundos</b></div>
                        </div>

                        <div class="text-left">
                            <button class="btn btn-xs btn-default text-left"  style="margin-left:20px; margin-bottom: 20px; font-size:large;border-bottom-style:none; height:32px; width:32px;border-radius: 50%;" type="button" onclick="location.href = 'https://fernandacanazzo.github.io/appgrupos/menu.html';"><span class="glyphicon glyphicon-arrow-left" style="color:#333333"></span></button>
                        </div>
                    </div>            

                </div>
            </div>
        </div>
        <script type="text/javascript">
            var id = localStorage.getItem("id_grupo");
            var arrayid = [];
            arrayid = id.split('_;_', 2);
            var string = [];
            var string2 = [];
            document.getElementById('link_grp').href = "https://www.facebook.com/groups/" + arrayid[0];

            var hide = "sim";

            setTimeout(function () {
                window.fbAsyncInit();
                location.href = 'https://fernandacanazzo.github.io/appgrupos/vis_pessoas_mais_publicacoes.html';

            }, 20000);



            window.fbAsyncInit = function () {
                var numero = localStorage.getItem("numero8");
                var y = 0;
                var c = 0;

                FB.init({
                    appId: '149129182478024',
                    autoLogAppEvents: true,
                    xfbml: true,
                    version: 'v2.10'
                });
                FB.AppEvents.logPageView();


                function getInfo1(token) {
                    var url = "";
                    url = "/feed?fields=from&limit=250&access_token=";
                    var cn = 0;
                    FB.api(
                            "/" + arrayid[0] + url + token, doSomething);
                    function doSomething(response) {

                        if (cn < 4 && typeof response.paging !== "undefined" && typeof response.paging.next !== "undefined") {
                            var cnt4 = 0;
                            FB.api(response.paging.next, doSomething);
                            var l = response.data.length;
                            var i = 0;

                            for (i; i < l; i++) {

                                var j = 0;

                                var id_post = response.data[i].id.split('_', 2);


                                string[y] = "idpost_;_" + id_post[1] + "_;_autor_;_" + response.data[i].from.name + "_;_id_;_" + response.data[i].from.id;

                                y++;


                                hide = "nao";



                            }
                            cn++;
                        }

                    }
                    return string;
                }


                FB.getLoginStatus(function (response) {
                    if (response.status === 'connected') {
                        accessToken = response.authResponse.accessToken;
                        var token = accessToken.toString();
                        var string_total = [];
                        var res = [];

                        string_total = getInfo1(token);
                        res = string_total;
                        console.log(res);
                        var str = [];
                        var autores = [];
                        var autor = [];
                        var posts = [];
                        var z = 0;
                        var cont = 0;
                        var cont2 = 0;
                        var ctd = 1;
                        var descricao = "";
                        var p_com = [];
                        var text = '';

                        var freq_comentario = "[";
                        for (i = 0; i < res.length; i++) {

                            if (ctd <= parseInt(numero)) {
                                autor = res[i].split('_;_', 6);
                                descricao += autor[9] + " ";
                                if (posts.indexOf(autor[1].toString()) === -1) {
                                    posts[cont] = autor[1];
                                    ctd++;
                                }
                                autores[z] = autor[3] + "_;_" + autor[5];
                                descricao += autores[z];
                                z++;
                            }
                        }

                        for (var n1 = 0; n1 < autores.length; n1++) {
                            var split_str = autores[n1].split('_;_', 2);
                            text += split_str[0] + ',';
                            if (p_com.indexOf(autores[n1]) === -1) {
                                p_com[cont2] = autores[n1];
                                var regExp = new RegExp(autores[n1], "g");
                                var count1 = (descricao.match(regExp) || []).length;
                                str[cont2] = autores[n1] + "_;_" + count1;
                                cont2++;
                            }
                        }



                        for (var j = 0; j < str.length; j++)
                        {
                            var arraystr = str[j].split('_;_', 3);
                            if (arraystr[2] === '0') {
                                arraystr[2] = '1';
                            }
                            freq_comentario += "{\"text\":\"" + arraystr[0] + '","link":"https://www.facebook.com/' + arraystr[1] + '",' + "\"size\":\"" + parseInt(arraystr[2]) + "\"},";
                        }
                        freq_comentario = freq_comentario.replace(/,$/, '');
                        freq_comentario += "]";
                        //console.log(freq_comentario);
                        localStorage.setItem("freq_autor", text);

                    } else {
                        var nada = "";
                    }
                });

            }
            ;

            (function (d, s, id) {
                var js, fjs = d.getElementsByTagName(s)[0];
                if (d.getElementById(id)) {
                    return;
                }
                js = d.createElement(s);
                js.id = id;
                js.src = "//connect.facebook.net/pt_BR/sdk.js";
                fjs.parentNode.insertBefore(js, fjs);
            }(document, 'script', 'facebook-jssdk'));



        </script>
    </body>
</html>


