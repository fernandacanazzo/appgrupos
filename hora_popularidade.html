<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js"></script>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/shop-homepage.css" rel="stylesheet">
    <title>App</title>
    <style>
        .fixed-panel {
            max-height: 570px;
            overflow-y: auto;
        }
        
        .bar {
            fill: #A02974;
            shape-rendering: crispEdges;
        }
        
        .axis path,
        .axis line {
            fill: none;
            stroke: #000;
            shape-rendering: crispEdges;
        }
        
        .x.axis path {
            display: none;
        }
    </style>

</head>

<body style="background-color: #f7f7f7">

    <script type="text/javascript">
        var id = localStorage.getItem("id_grupo");
        var arrayid = [];
        arrayid = id.split('_;_', 2);
        var string = [];
        var string2 = ["04" + "_;_" + "06" + "_;_" + "18" + "_;_" + "12" + "_;_" + "30" + "_;_" + "00" + "_;_reacoes_;_" + "66" +
                                "_;_comentarios_;_" + "23" + "_;_id_;_" + "1" + "_;_descricao_;_" + "Camisetas do Brasil (réplica) identica..",
                    "04" + "_;_" + "06" + "_;_" + "18" + "_;_" + "12" + "_;_" + "00" + "_;_" + "00" + "_;_reacoes_;_" + "86" +
                                "_;_comentarios_;_" + "33" + "_;_id_;_" + "2" + "_;_descricao_;_" + "Estamos adorando a repercussão dos workshops! \nÉ muito bom poder passar pra vocês um pouquinho do que sabemos fazer, uma parcela de algo que nos deixa tão feliz. \nAS INSCRIÇÕES PARA MAIS UM WORKSHOP ESTÃO ABERTAS!",
                    "14" + "_;_" + "05" + "_;_" + "18" + "_;_" + "18" + "_;_" + "35" + "_;_" + "00" + "_;_reacoes_;_" + "30" +
                                "_;_comentarios_;_" + "10" + "_;_id_;_" + "3" + "_;_descricao_;_" + "Entre em contato para maiores informações e saiba mais sobre nossas prestações de serviço.",
                    "24" + "_;_" + "05" + "_;_" + "18" + "_;_" + "15" + "_;_" + "34" + "_;_" + "00" + "_;_reacoes_;_" + "26" +
                                "_;_comentarios_;_" + "10" + "_;_id_;_" + "4" + "_;_descricao_;_" + "Alugo, um Ponto Comercial recém reformado,com uma cozinha. O Ponto está localizado no Bairro São Vicente.",
                    "12" + "_;_" + "06" + "_;_" + "18" + "_;_" + "1" + "_;_" + "11" + "_;_" + "00" + "_;_reacoes_;_" + "10" +
                                "_;_comentarios_;_" + "2" + "_;_id_;_" + "5" + "_;_descricao_;_" + "Aluga_ se casa nova, boa localização próximo igreja santo Antônio, dois quartos,cozinha americana, área de serviço. Tudo novo\nO aluguel é R$650",
                    "12" + "_;_" + "06" + "_;_" + "18" + "_;_" + "6" + "_;_" + "18" + "_;_" + "00" + "_;_reacoes_;_" + "5" +
                                "_;_comentarios_;_" + "1" + "_;_id_;_" + "6" + "_;_descricao_;_" + "Pedacinho do Céu - Doces\nEspecializada em sabores de família, fazemos doces para diversas ocasiões, completar seus momentos fora de rotina e comemorações!",
                    "10" + "_;_" + "06" + "_;_" + "18" + "_;_" + "6" + "_;_" + "30" + "_;_" + "00" + "_;_reacoes_;_" + "6" +
                                "_;_comentarios_;_" + "1" + "_;_id_;_" + "7" + "_;_descricao_;_" + "Excursão para compras no BRÁS em São Paulo-SP\n SAÍDA TODA TERÇA E SEXTA FEIRA .",
                    "03" + "_;_" + "06" + "_;_" + "18" + "_;_" + "8" + "_;_" + "55" + "_;_" + "00" + "_;_reacoes_;_" + "12" +
                                "_;_comentarios_;_" + "3" + "_;_id_;_" + "8" + "_;_descricao_;_" + "Vendo um microfone sem fio karsest semi novo original interessado falar comigo",
                    "07" + "_;_" + "06" + "_;_" + "18" + "_;_" + "9" + "_;_" + "44" + "_;_" + "00" + "_;_reacoes_;_" + "17" +
                                "_;_comentarios_;_" + "6" + "_;_id_;_" + "9" + "_;_descricao_;_" + "VENDE-SE OU TROCA-SE APTO NA CIDADE DE CAMPINAS SP COM ÁREA DE 233M² NO 2º ANDAR",
                    "09" + "_;_" + "06" + "_;_" + "18" + "_;_" + "7" + "_;_" + "20" + "_;_" + "00" + "_;_reacoes_;_" + "9" +
                                "_;_comentarios_;_" + "3" + "_;_id_;_" + "10" + "_;_descricao_;_" + "VENDE-SE APTO NO PRIMEIRO PISO NO BAIRRO BOA VISTA EM ITAJUBÁ MG ",
                    "03" + "_;_" + "06" + "_;_" + "18" + "_;_" + "19" + "_;_" + "30" + "_;_" + "00" + "_;_reacoes_;_" + "22" +
                                "_;_comentarios_;_" + "13" + "_;_id_;_" + "11" + "_;_descricao_;_" + "CURSO DE ATENDENTE DE FARMÁCIA E AUXILIAR DE MANIPULAÇÃO DE MEDICAMENTOS",
                    "02" + "_;_" + "06" + "_;_" + "18" + "_;_" + "13" + "_;_" + "34" + "_;_" + "00" + "_;_reacoes_;_" + "80" +
                                "_;_comentarios_;_" + "44" + "_;_id_;_" + "12" + "_;_descricao_;_" + "Em caso de acidente de trânsito, acione o Minas Seguro DPVAT",
                    "01" + "_;_" + "06" + "_;_" + "18" + "_;_" + "13" + "_;_" + "39" + "_;_" + "00" + "_;_reacoes_;_" + "90" +
                                "_;_comentarios_;_" + "50" + "_;_id_;_" + "13" + "_;_descricao_;_" + "Manutençao em Notebooks, Netbooks, Desktop, Tablets, Celular e GPS - Serviço totalmente online para seu conforto!!",
                    "01" + "_;_" + "06" + "_;_" + "18" + "_;_" + "13" + "_;_" + "22" + "_;_" + "00" + "_;_reacoes_;_" + "75" +
                                "_;_comentarios_;_" + "47" + "_;_id_;_" + "14" + "_;_descricao_;_" + "Refil algodão 22 reais. Cereja e avelã 20 reais....entrego",
                    "10" + "_;_" + "06" + "_;_" + "18" + "_;_" + "18" + "_;_" + "12" + "_;_" + "00" + "_;_reacoes_;_" + "30" +
                                "_;_comentarios_;_" + "12" + "_;_id_;_" + "15" + "_;_descricao_;_" + "Vende-se esse tênis original da fila usado apenas 2vezes",
                    "10" + "_;_" + "06" + "_;_" + "18" + "_;_" + "20" + "_;_" + "00" + "_;_" + "00" + "_;_reacoes_;_" + "33" +
                                "_;_comentarios_;_" + "13" + "_;_id_;_" + "16" + "_;_descricao_;_" + "Venha fazer um incrível passeio nas cidades históricas de São João Del Rei e Tiradentes",
                    "10" + "_;_" + "06" + "_;_" + "18" + "_;_" + "22" + "_;_" + "02" + "_;_" + "00" + "_;_reacoes_;_" + "23" +
                                "_;_comentarios_;_" + "9" + "_;_id_;_" + "17" + "_;_descricao_;_" + "Vende-se Mesa pequena usada cor cinza sem gavetas R$ 80",
                    "08" + "_;_" + "06" + "_;_" + "18" + "_;_" + "23" + "_;_" + "06" + "_;_" + "00" + "_;_reacoes_;_" + "19" +
                                "_;_comentarios_;_" + "8" + "_;_id_;_" + "18" + "_;_descricao_;_" + "Alugo sala comercial no edifício Santa Clara, rua Coronel Francisco Braz, 185,Centro. Itajubá.",
                    "09" + "_;_" + "06" + "_;_" + "18" + "_;_" + "4" + "_;_" + "39" + "_;_" + "00" + "_;_reacoes_;_" + "5" +
                                "_;_comentarios_;_" + "1" + "_;_id_;_" + "19" + "_;_descricao_;_" + "Venha conhecer as incríveis fazendas históricas de BANANAL nesse DOMINGO dia 17 de junho",
                    "09" + "_;_" + "06" + "_;_" + "18" + "_;_" + "20" + "_;_" + "31" + "_;_" + "00" + "_;_reacoes_;_" + "18" +
                                "_;_comentarios_;_" + "6" + "_;_id_;_" + "20" + "_;_descricao_;_" + "[VENDO] Guarda roupa - R$ 150,00"];
                      
        var string3 = [];
        var string4 = [];
        var mem_count = 18000;

        var hide = "sim";
        setTimeout(function() {
            window.fbAsyncInit();
            location.href = 'https://fernandacanazzo.github.io/appgrupos/vis_hora_popularidade.html';


        }, 15000);

        window.fbAsyncInit = function() {
            var numero = localStorage.getItem("numero4");
            var y = 0;

            FB.init({
                appId: '149129182478024',
                autoLogAppEvents: true,
                xfbml: true,
                version: 'v2.10'
            });
            FB.AppEvents.logPageView();

            function getCount(token) {
               /* var url = "";
                url = "/members?summary=true&access_token=";

                FB.api(
                    "/" + arrayid[0] + url + token,
                    function(response) {
                        mem_count = response.summary.total_count;
                    });*/
                return mem_count;

            }

            function getInfo2(token) {
              /*  var url = "";
                url = "/feed?fields=reactions.summary(true),comments.summary(true), message, created_time&limit=50&access_token=";
                var cn = 0;
                FB.api(
                    "/" + arrayid[0] + url + token, doSomething);

                function doSomething(response) {
                    if (cn < 20 && typeof response.paging !== "undefined" || typeof response.paging.next !== "undefined") {
                        FB.api(response.paging.next, doSomething);

                        var l = response.data.length;
                        var i = 0;
                        for (i; i < l; i++) {

                            var reacoes = response.data[i].reactions.summary.total_count;
                            var comentarios = response.data[i].comments.summary.total_count;
                            var id_post = response.data[i].id.split('_', 2);
                            var data_hora = response.data[i].created_time.split('T', 2);
                            var data = data_hora[0].split('-', 3);
                            var hora = data_hora[1].split(':', 3);

                            string2[y] = data[2] + "_;_" + data[1] + "_;_" + data[0] + "_;_" + hora[0] + "_;_" + hora[1] + "_;_" + hora[2] + "_;_reacoes_;_" + reacoes +
                                "_;_comentarios_;_" + comentarios + "_;_id_;_" + id_post[1] + "_;_descricao_;_" + response.data[i].message;

                            y++;
                        }
                        cn++;
                        hide = "nao";
                    }

                }*/
        hide = "nao";
                return string2;

            }



            FB.getLoginStatus(function(response) {
                if (response.status === 'connected') {
                    accessToken = response.authResponse.accessToken;
                    var token = accessToken.toString();
                    var string_total = [];
                    var res = [];
                    var mem_count2 = getCount(token);
                    string_total = getInfo2(token);
                    res = string_total;
                    var str = "";
                    var qtd = 0;
                    var total = 0;
                    var dados_posts4 = "[";
                    var ctd = 1;

                    function naturalCompare(b, a) {
                        var ax = [],
                            bx = [];

                        a.replace(/(\d+)|(\D+)/g, function(_, $1, $2) {
                            ax.push([$1 || Infinity, $2 || ""])
                        });
                        b.replace(/(\d+)|(\D+)/g, function(_, $1, $2) {
                            bx.push([$1 || Infinity, $2 || ""])
                        });

                        while (ax.length && bx.length) {
                            var an = ax.shift();
                            var bn = bx.shift();
                            var nn = (an[0] - bn[0]) || an[1].localeCompare(bn[1]);
                            if (nn)
                                return nn;
                        }

                        return ax.length - bx.length;
                    }

                    res = res.sort(naturalCompare);

                    var min = 0;
                    var horario = 0;
                    var json = [];
                    for (i = 0; i < res.length; i++) {
                        if (ctd <= parseInt(numero)) {
                            str = res[i].split('_;_', 14);
                            str[13] = str[13].replace(/(\r\n|\n|\r|\f|\"|\\)/gm, " ");
                            str[13] = str[13].replace("undefined", "Essa publicação não possui uma descrição");
                            total = ((parseInt(str[7]) + parseInt(str[9])) / parseInt(mem_count2)) * 100;
                            min = parseInt(str[4]) / 60;
                            horario = parseInt(str[3]) + min;
                            qtd++;
                            // dados_posts2 += "{\"cont\":\"" + qtd + "\",\"size\":" + total + ",\"id\":\"" + str[9] + "\",\"desc\":\"" + str[11] + "\",\"reacoes\":\"" + str[3] + "\",\"comentarios\":\"" + str[5] + "\",\"dia\":\"" + str[0] + "\",\"mes\":\"" + str[1] + "\"},";
                            //dados_posts4 += '{x:' + horario + ', y:' + total + '},';
                            dados_posts4 += '[' + horario + ',' + total + '],';
                            //json.push(horario, total);
                            var x = {};
                            x.x = horario;
                            x.y = total;
                            x.name = str[13];
                            x.hora = str[3] + ':' + str[4]
                            x.link = 'https://facebook.com/groups/' + arrayid[0] + '/permalink/' + str[11];
                            json.push(x);
                        }
                        ctd++;
                    }


                    dados_posts4 = dados_posts4.replace(/,$/, '');
                    dados_posts4 += "]";

                    localStorage.setItem('dados_posts4', JSON.stringify(json));
                    console.log(json);
                    if (hide !== "sim") {

                    }
                } else {
                    var nada = "";
                }
            });

        };

        (function(d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) {
                return;
            }
            js = d.createElement(s);
            js.id = id;
            js.src = "//connect.facebook.net/pt_BR/sdk.js";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));
    </script>

    <script type="text/javascript"></script>
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-nav"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button>
                <a class="navbar-brand" href="#" style="margin-top: 4px;"><b>Aplicação para grupos</b></a></div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="main-nav">
                <ul class="nav navbar-nav navbar-right">
                    <li><a style="margin-top: 4px;" href="https://fernandacanazzo.github.io/appgrupos/index.html"><span class="glyphicon glyphicon-search " style=" font-size:small;margin-right: 6px;"></span>Pesquisar grupo</a></li>
                    <li><a id="link_grp" style="margin-top: 4px;" href="#" target="_blank"><span class="glyphicon glyphicon-eye-open" style=" font-size:small;margin-right: 6px;"></span>Ver grupo no Facebook</a></li>

                </ul>

            </div>
            <!-- collapse navbar-collapse -->
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container-fluid -->
    </nav>
    <div class="container">
        <div class="row">
            <div class="col-md-6 col-md-offset-3" style="border-style: solid; border-width:1px; border-radius:10px; border-color:#f7f7f7">

                <div class="panel panel-primary" style="width: 100%;margin-top:50px; ">
                    <div class="panel-body text-center" style="height:85px;">

                        <div id="aviso3" class="text-center" style=" margin-top:18px"><b>Procurando publicações... por favor aguarde alguns segundos</b></div>
                    </div>

                    <div class="text-left">
                        <button class="btn btn-xs btn-default text-left" style="margin-left:20px; margin-bottom: 20px; font-size:large;border-bottom-style:none; height:32px; width:32px;border-radius: 50%;" type="button" onclick="location.href = 'https://fernandacanazzo.github.io/appgrupos/menu.html';"><span class="glyphicon glyphicon-arrow-left" style="color:#333333"></span></button>
                    </div>
                </div>

            </div>

        </div>

    </div>
</body>

</html>